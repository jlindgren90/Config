#!/bin/sh

internal=DP-3

if test x"${DISPLAY%.1}" = x"${DISPLAY}" ; then
  position="--right-of ${internal}"
else
  position=""
fi

case ${SRANDRD_ACTION} in
  *" connected")
    output=${SRANDRD_ACTION% connected}
    if ! test -f "/tmp/setup-desktop-${output}-connected" ; then
      touch "/tmp/setup-desktop-${output}-connected"
      xrandr --output ${output} --auto --primary ${position}
      feh --bg-fill "$HOME/.wallpaper.jpg"
    fi
    ;;
  *" disconnected")
    output=${SRANDRD_ACTION% disconnected}
    if test -f "/tmp/setup-desktop-${output}-connected" ; then
      rm "/tmp/setup-desktop-${output}-connected"
      xrandr --output ${output} --off
    fi
    ;;
  *)
    outputs=$(xrandr | grep " connected" | cut -d" " -f1)
    for output in ${outputs} ; do
      if test ${output} != ${internal} ; then
        touch "/tmp/setup-desktop-${output}-connected"
        xrandr --output ${output} --auto --primary ${position}
      fi
    done
    feh --bg-fill "$HOME/.wallpaper.jpg"
    ;;
esac
